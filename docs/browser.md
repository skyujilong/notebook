# 浏览器

## 并行处理

计算机中并行处理就是同一时刻处理多个任务。

```javascript
    let a = 1+2;
    let b = 20 / 5;
    let c = 7*8
```
如上，正常情况下是但线程来处理上述的任务，将上述每行的任务入队。之后依次执行。

![图线程图](https://github.com/skyujilong/notebook/blob/master/src/process.png)

单个线程：
1. 执行第一行
1. 执行第二行
1. 执行第三行

顺序的三步


如果采用多线程，比方说我们有两个线程 a 、线程 b 。
1. 第一行分配给 a线程
1. 第二行分配给 b线程
1. 第三行分配给 a线程（队列关系）
1. 之后进行执行，两个线程，a线程执行2次，b执行一次， 因为a&b是两条并行的线程，因此执行速度得到加快



## 进程与线程的区别

cpu执行的最小单元是进程。一个进程可以有多个线程。

如何理解？
> 一个进程好比一个工厂，线程，好比一个工厂的工人， 一个工厂拥有多个工人！

## 进程与线程的特点
进程挂掉了，会回收所有的线程。

单一线程挂掉了， 会引起进程的崩溃。

线程与线程之间可以共享数据，但是进程与进程之间是隔离的。

## 早期浏览器

早期的浏览器都是单独的进程的（所有的模块都运行在单独的这个进程下）。

特点：

1. 插件一崩溃，导致浏览器直接挂掉。
1. js执行while(true)，会导致整个浏览器崩溃。
1. js发生内存泄漏，会导致整个浏览器的内存跟着飙升。

从进程与线程的特点，应该就能 分析出来为什么会产生上面的问题了。

## 现在的浏览器(chrome)

多进程的浏览器

优点：
1. 插件崩溃，不会导致浏览器的崩溃。
1. js死锁也不会导致整个浏览器的崩溃，只有当前的tab页会无响应。
1. tab页的关闭，会完整释放这个tab页用到的内存。

从上述的描述中，我们大致可以猜测到。

页面的tab单独一个进程，插件机制也是独立的进程。

因为进程之间是隔离的，所以单个进程的崩溃，不会影响其他的进程。

tab关闭的释放内存，也是同样的，一个进程的结束，会释放该进程所占用的内存（操作系统释放）。

缺点：

主要是资源的开销，会比单进程的浏览器要高的多。

复杂性，要高很多。

## chrome当前的架构

![浏览器架构图](https://github.com/skyujilong/notebook/blob/master/src/browser-arch2.png)

简单来看
 
1. Browser 主要负责界面显示、用户交互、子进程管理、书签、前进后退，同时提供存储等功能。
1. Renderer 每个tab标签，都有一个Renderer进程，该进程主要负责页面呈现渲染。
1. Plugin 组件（eg:flash），独立的进程
1. GPU 负责复合层的渲染（translate3d，will-change：transform）

从上面的架构，可以看到一个多进程的浏览器。

## 为什么了解浏览器

主要是为了了解如何让页面更快的呈现在用户面前，并且不在发生卡顿。

## 参考
[inside-browser](https://developers.google.com/web/updates/2018/09/inside-browser-part1)

## TODO:
继续深入了解整个chrome