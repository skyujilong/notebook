# HTTP 队头阻塞

## 优化

要从http的优化上来讲。

1. 从HTTP1.0开始增加了持久连接（keep-alive）的概念（原来是一个http请求用一次tcp/ip连接，启用keep-alive是多个http请求复用一个tcp/ip连接）。
1. 单个域名创建多个连接（有限制，要不资源开销大，一般一个域名是4个并行连接）。
1. 采用管道技术(PIPE)，一个tcp上一次发送多请求。

## pipe vs no pipe
![http-pipe](https://github.com/skyujilong/notebook/blob/master/src/HTTP-PIPE.PNG)

## 管道化的限制

> 1. 管道化要求服务端按照请求发送的顺序返回响应（FIFO），原因很简单，HTTP请求和响应并没有序号标识，无法将乱序的响应与请求关联起来。
> 1. 客户端需要保持未收到响应的请求，当连接意外中断时，需要重新发送这部分请求。 
> 1. 只有幂等的请求才能进行管道化，也就是只有GET和HEAD请求才能管道化，否则可能会出现意料之外的结果

## 原因

http 管道化是要求**服务器端的返回按照客户端的请求顺序予以返回响应的（FIFO先进先出）**。原因是http请求头和响应都是没有序号标识的!!

无序响应无法和请求相互对应。

客户端需要保持未收到的响应请求，当连接意外中断的时候，需要重新发送该部分的请求。

**管道化，要求FIFO，如果中间有丢包，那么需要等待该丢包内容送达，其他的后续内容才能继续送达。**

# 解决方案

采用新的协议，比方说quic协议，采用http2，研究待续。